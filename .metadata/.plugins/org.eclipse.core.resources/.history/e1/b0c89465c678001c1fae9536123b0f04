package com.project;

import java.io.InputStream;
import java.net.URL;
import java.text.NumberFormat;
import java.util.Scanner;

import javax.xml.parsers.DocumentBuilder;
import javax.xml.parsers.DocumentBuilderFactory;

import org.w3c.dom.Document;
import org.w3c.dom.Element;
import org.w3c.dom.Node;
import org.w3c.dom.NodeList;

public class Covid {
	
	NumberFormat numberFormat = NumberFormat.getInstance(); 
	
	double a;
	double b;
	double c;
	double d;
	
	
	// 코로나 확진자, 사망자 공공API 데이터 가져오기 //
	public void covid() { 

		try {
			
			DocumentBuilderFactory f = DocumentBuilderFactory.newInstance();
			DocumentBuilder parser = f.newDocumentBuilder();

			
			// 날짜설정 // // 캘린더 보류!!!
			Scanner sc = new Scanner(System.in);
			int date;

			do {
				System.out.println("날짜를 입력하세요[20220101]");
				date = sc.nextInt();

			} while (date < 20200101 || date > 20220119);

			
			//// 당일자 URL 데이터 읽기 ////
			String url = "http://openapi.data.go.kr/openapi/service/rest/Covid19"
					+ "/getCovid19InfStateJson?serviceKey=NCIUqcH3S7%2B53YimC1Rc"
					+ "H3h3AiFSpZrWZMfmjJGXFVZNGhf2BGW25igritgTfMcgMe4Gxd8qbS9nb%"
					+ "2F6%2BwBycXw%3D%3D&pageNo=1&numOfRows=10&" + "startCreateDt=" + date + "&endCreateDt=" + date;

			Document xmlDoc = null;
			xmlDoc = parser.parse(url);

			// 노드 읽기
			Element root = xmlDoc.getDocumentElement();
			Node body = root.getLastChild();
			Node items = body.getFirstChild();
			Node item = items.getFirstChild();
			NodeList itemList = item.getChildNodes();

			Node a1 = itemList.item(3);
			Node b1 = itemList.item(2);

			// 노드에 있는 값 Double로 받아오기
			a = Double.parseDouble(a1.getChildNodes().item(0).getNodeValue());
			b = Double.parseDouble(b1.getChildNodes().item(0).getNodeValue());


			
			//// 전일자 URL 데이터 읽기 ////
			url = "http://openapi.data.go.kr/openapi/service/rest/Covid19"
					+ "/getCovid19InfStateJson?serviceKey=NCIUqcH3S7%2B53YimC1Rc"
					+ "H3h3AiFSpZrWZMfmjJGXFVZNGhf2BGW25igritgTfMcgMe4Gxd8qbS9nb%"
					+ "2F6%2BwBycXw%3D%3D&pageNo=1&numOfRows=10&" + "startCreateDt=" + (date - 1) + "&endCreateDt="
					+ (date - 1);

			xmlDoc = parser.parse(url);

			// 노드 읽기
			root = xmlDoc.getDocumentElement();
			body = root.getLastChild();
			items = body.getFirstChild();
			item = items.getFirstChild();
			itemList = item.getChildNodes();

			Node c1 = itemList.item(3);
			Node d1 = itemList.item(2);

			// 노드에 있는 값 Double로 받아오기
			c = Double.parseDouble(c1.getChildNodes().item(0).getNodeValue());
			d = Double.parseDouble(d1.getChildNodes().item(0).getNodeValue());
			
		} catch (Exception e) {
			System.out.println(e.toString());
		}
	}

	
	// 누적 코로나 확진자, 사망자 
	public void total() {

		// 3자리 수 마다 콤마찍기 (111,111)
		String str1 = numberFormat.format(a);
		String str2 = numberFormat.format(b);

		System.out.println("누적확진자: " + str1 + "명,  누적사망자: " + str2 + "명\n");

	}
	
	
	// 일일 코로나 확진자, 사망자
	public void daily() {

		String str3 = numberFormat.format(a - c); 
		String str4 = numberFormat.format(b - d);
		
		System.out.println("일일확진자: " + str3 + "명,  일일사망자: " + str4 + "명\n");

	}

}
